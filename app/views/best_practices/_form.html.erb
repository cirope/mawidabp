<%= simple_form_for @best_practice do |f| %>
  <% js_extra = "var process_control='" + generate_template(f,
    :process_controls, :object => ProcessControl.new) + "';" %>
  <%= f.error_notification %>

  <div class="form-inputs">
    <div class="row">
      <div class="col-md-6">
        <%= f.input :name, input_html: { maxlength: 255 } %>
        <%= f.input :description %>
      </div>
    </div>
  </div>

  <div class="items">
    <h3><%= ProcessControl.model_name.human %></h3>

    <div id="process_controls">
      <% co_template = nil %>
      <%= f.simple_fields_for :process_controls do |p_f| %>
        <% co_template ||= generate_template(p_f,
            :control_objectives, :child_index => 'NEW_SUBRECORD') %>
        <% js_extra << "var control_objective = '#{co_template}';" unless co_template == 0 %>
        <% co_template = 0 %>
        <%= render partial: 'process_control',
          locals: { f: p_f, best_practice: @best_practice, is_dynamic: false } %>
      <% end %>
    </div>

    <%= link_to t('best_practice.add_process_control'), '#',
      'data-template' => :process_control, 'data-event' => 'addNestedItem',
      'data-container' => '#process_controls', class: 'btn btn-default btn-sm' %>
  </div>

  <hr />

  <div class="form-actions form-footer">
    <div class="pull-right"><%= yield :form_actions %></div>
    <%= f.input :organization_id, as: :hidden %>
    <%= f.input :lock_version, as: :hidden %>
    <%= f.submit class: 'btn btn-primary' %>
  </div>

  <% content_for :js_extra do %>
    <%= raw js_extra %>
  <% end %>
<% end %>
