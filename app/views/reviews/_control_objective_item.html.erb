<% control_objective_item = f.object %>
<fieldset class="control_objective_item">
  <% if control_objective_item.new_record? %>
    <div class="hidden">
      <%= f.input :control_objective_id, as: :hidden %>
      <%= f.input :control_objective_text, as: :hidden %>
      <%= f.simple_fields_for :control do |c_f| %>
        <%= c_f.input :control, as: :hidden %>
        <%= c_f.input :effects, as: :hidden %>
        <%= c_f.input :design_tests, as: :hidden %>
        <%= c_f.input :compliance_tests, as: :hidden %>
        <%= c_f.input :sustantive_tests, as: :hidden %>
      <% end %>
    </div>
  <% else %>
    <ul>
      <li>
        <% if control_objective_item.continuous %>
          <span class="glyphicon glyphicon-repeat"></span>
        <% end %>
        <%= content_tag :span, control_objective_item.control_objective_text,
          :class => ('strike text-muted' if control_objective_item.finished) %>
        <% if !readonly %>
          <span class="text-muted">|</span>
          <%= link_to_move %>
          <span class="text-muted">|</span>
          <%= link_to_edit edit_control_objective_item_path(control_objective_item) %>
          <% if control_objective_item.can_be_destroyed? %>
            <span class="text-muted">|</span>
            <%= link_to_remove_nested_item(f)  %>
          <% end %>
          <%= f.input :id, as: :hidden %>
          <%= f.input :order_number, as: :hidden, input_html: { class: 'sort_number' } %>
        <% end %>
        <% if control_objective_item.weaknesses.exists? %>
          <ul>
            <% control_objective_item.weaknesses.each do |weakness| %>
              <li>
                <span class="text-danger">
                  <%= [weakness.review_code, weakness.title].compact.join(' - ') %>
                </span>
              </li>
            <% end %>
          </ul>
        <% end %>
      </li>
    </ul>
  <% end %>
</fieldset>
