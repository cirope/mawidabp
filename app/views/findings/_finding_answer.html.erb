<%
  finding_answer ||= f.object
  finding_answer.user ||= @auth_user
%>
<fieldset class="finding_answer">
  <hr />

  <div class="row">
    <div class="col-md-2">
      <%= finding_answer.user.full_name %>
      <% if finding_answer.new_record? %>
        <%= f.input :user_id, as: :hidden, input_html: { id: @auth_user.id, value: @auth_user.id }  %>
      <% end %>
    </div>
    <div class="col-md-6">
      <% if finding_answer.new_record? %>
        <%= f.input :answer, label: false %>
      <% else %>
        <%= simple_format finding_answer.answer, class: 'mb-1' %>
        <% if show_follow_up_timestamps? %>
          <p class="small text-muted"><%= l(finding_answer.created_at, format: :long) %></p>
        <% end %>
      <% end %>
    </div>
    <div class="col-md-2">
      <% if !finding_answer.file_model.try(:file?) || finding_answer.file_model.new_record? %>
        <% if finding_answer.new_record? %>
          <%= f.simple_fields_for :file_model, file_model(f.object) do |fm_f| %>
            <div class="file-container float-left">
              <%= link_to_upload(fm_f.object) %>
              <% if fm_f.object.file_cache %>
                <%= fm_f.input :file, label: false %>
                <%= fm_f.input :file_cache, as: :hidden %>
              <% else %>
                <%= fm_f.input :file, label: false %>
              <% end %>
            </div>
            <%= link_to '#', class: 'float-left', hidden: fm_f.object.file_cache.blank?, data: { clear_file: 'file' } do %>
              <%= icon 'fas', 'times' %>
            <% end %>
          <% end %>
        <% else %>
          -
        <% end %>
      <% else %>
        <%= link_to_download finding_answer %>
        <%= link_to_create_work_paper finding_answer %>
      <% end %>
    </div>
    <div class="col-md-2 text-right">
      <% if finding_answer.persisted? %>
        <div class="<%= show_follow_up_timestamps? ? 'text-right' : 'float-right' %>">
          <%= render 'readings/reading', finding_answer: finding_answer %>
        </div>
        <% if finding_answer.commitment_date %>
          <strong><%= FindingAnswer.human_attribute_name 'commitment_date' %></strong>:
          <br /><%= l(finding_answer.commitment_date, format: :long) %>
        <% end %>
      <% else %>
        <% if show_commitment_date?(finding_answer) %>
          <div class="text-left">
            <%= f.input :commitment_date, as: :date_picker, label: false, hint:
              FindingAnswer.human_attribute_name(:commitment_date),
              input_html: { data: { required: true } } %>
          </div>
        <% end %>
        <%= finding_answer_notification_check(f) %>
        <%= f.input :user_id, as: :hidden %>
      <% end %>
    </div>
  </div>
</fieldset>
