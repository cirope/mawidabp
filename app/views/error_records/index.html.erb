<% if @query.blank? -%>
  <%= render :partial => 'shared/date_filter_form',
    :locals => {:action => :index, :extra_params => {}} %>
<% end -%>

<%= render :partial => 'shared/search', :locals => {
  :options => {},
  :columns => @query.blank? ? ErrorRecord::COLUMNS_FOR_SEARCH.keys : @columns
} %>

<table>
  <thead id="column_headers">
    <tr>
      <th></th>
      <%= make_filterable_column User.human_name, 'user' %>
      <%= make_not_available_column ErrorRecord.human_attribute_name(:created_at) %>
      <%= make_not_available_column ErrorRecord.human_attribute_name(:error) %>
      <%= make_filterable_column ErrorRecord.human_attribute_name(:data), 'data' %>
      <th colspan="2" style="text-align: right;"><%= link_to_search %></th>
    </tr>
  </thead>
  
  <tbody>
  <tr class="<%= cycle(:even, :odd) %>"><td></td><td colspan="5"></td><td></td></tr>
  <% @error_records.each do |error_record| -%>
    <tr class="<%= cycle(:even, :odd) %>">
      <td></td>
      <td><%=h error_record.user ? error_record.user.user : t(:'error_record.void_user') %></td>
      <td><%=h l(error_record.created_at, :format => :short) %></td>
      <td><%=h error_record.error_text %></td>
      <td><%= super_truncate(error_record.data, 40) %></td>
      <td><%= link_to_show error_record %></td>
      <td></td>
    </tr>
    <tr class="<%= cycle(:even, :odd) %>"><td></td><td colspan="5"></td><td></td></tr>
  <% end -%>
  </tbody>
</table>

<div id="links">
<%= pagination_links @error_records %>
<%= link_to t(:'label.back'), :controller => :login_records,
  :action => :choose %> |
<%= link_to t(:'label.download'), :action => :export_to_pdf,
  :range => {:from_date => @from_date, :to_date => @to_date} %>
<div style="clear: both;"></div>
</div>