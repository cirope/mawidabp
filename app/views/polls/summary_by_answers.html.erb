<%= render :partial => 'shared/filter_form',
  :locals => {:action => :summary_by_answers, :extra_params => {},
  :forms => {:poll_date_range => true, :questionnaire => true, :answered => true}} %>

<div id="showed_data">
  <% if @polls.present? %>
    <% @polls.each do |poll| %>
      <hr><br>
      <p>
        <% if poll.user.present? %>
          <b><%= Poll.human_attribute_name :user_id %>: </b>
            <%= poll.user.informal_name  %>
        <% elsif poll.customer_email.present? %>
          <b><%= Poll.human_attribute_name :customer_email %>: </b>
            <%= poll.customer_email  %>
        <% end %>
      </p>
      <p>
        <b><%= Poll.human_attribute_name :answered %>: </b>
          <%= poll.answered ? t('label.yes') : t('label.no')  %>
      </p>
      <p>
        <b><%= Poll.human_attribute_name :send_date %>: </b>
          <%= l poll.created_at.to_date, :format => :long %>
      </p>
      <% if poll.answered? %>
        <p>
          <b><%= Poll.human_attribute_name :answer_date %>: </b>
            <%= l poll.updated_at.to_date, :format => :long %>
        </p>
      <% end %>
      <p>
        <b><%= Questionnaire.human_attribute_name :questions %>:</b>
      </p>
      <ol>
        <% poll.answers.each do |answer| %>
          <li><%= answer.question.question %>
            <% if poll.answered? %>
              <% if answer.question.answer_multi_choice? %>
                <%= ": #{t "activerecord.attributes.answer_option.options.#{answer.answer_option.option}"}" %>
              <% elsif answer.question.answer_written? %>
                <%= ": #{answer.answer}" %>
              <% end %>
            <% end %>
            <br>
            <% if answer.comments.present? %>
              <%= Answer.human_attribute_name :comments %>:
              <%= answer.comments %>
            <% end %>
          </li>
        <% end %>
      </ol>

      <% if poll.comments.present? %>
        <p>
          <b><%= Poll.human_attribute_name :comments %>: </b>
          <%= poll.comments %>
        </p>
      <% end %>
      <br>
  <% end %>
  <hr>
  <p style="margin: 1em; font-size: 1.1em;">
    <%= "#{t('poll.total_answered')}: #{@answered}" %><br>
    <%= "#{t('poll.total_unanswered')}: #{@unanswered}" %><br>
    <br>
    <b><%= "#{t('poll.score')}: #{@calification}%" %></b>
  </p>

<% else %>
  <p style="margin: 1em;">
    <em><%= t('poll.without_data') %></em>
  </p>
<% end %>
</div>

<div id="links">
  <%= link_to t('label.back'), :action => :index %> |
  <%= link_to_function t('label.download'),
    "Helper.showItem('#customize_report_form')" %>
</div>
<div id="customize_report_form" style="display: none;">
  <div>
  <%= render :partial => 'shared/customize_report_form', :locals => {
    :options => {
      :form_name => 'report',
      :url => request.query_parameters.merge(
        {:action => :create_summary_by_answers, :_ts => Time.now.to_i}
      ),
      :fields => [
        {
          :name => :report_title,
          :label => t('customize_report_form.title'),
          :value => t('poll.report_title')
        },
        {
          :name => :report_subtitle,
          :label => t('customize_report_form.subtitle'),
          :value => t('poll.summary_by_answers_subtitle')
        }
      ]
    }
  } %>
  </div>
</div>
