<%= render :partial => 'shared/filter_form',
  :locals => {:action => :summary_by_answers, :extra_params => {},
  :forms => {:poll_date_range => true, :questionnaire => true, :answered => true}} %>

<% if @polls.present? %>
  <% @polls.each do |poll| %>
    <hr />
    <p>
      <% if poll.user.present? %>
        <strong><%= Poll.human_attribute_name :user_id %>: </strong>
          <%= poll.user.informal_name  %>
      <% elsif poll.customer_email.present? %>
        <strong><%= Poll.human_attribute_name :customer_email %>: </strong>
          <%= poll.customer_email  %>
      <% end %>
    </p>
    <p>
      <strong><%= Poll.human_attribute_name :answered %>: </strong>
        <%= poll.answered ? t('label.yes') : t('label.no')  %>
    </p>
    <p>
      <strong><%= Poll.human_attribute_name :send_date %>: </strong>
        <%= l poll.created_at.to_date, :format => :long %>
    </p>
    <% if poll.answered? %>
      <p>
        <strong><%= Poll.human_attribute_name :answer_date %>: </strong>
          <%= l poll.updated_at.to_date, :format => :long %>
      </p>
    <% end %>
    <p>
      <strong><%= Questionnaire.human_attribute_name :questions %>:</strong>
    </p>
    <ol>
      <% poll.answers.each do |answer| %>
        <li><%= answer.question.question %>
          <% if poll.answered? %>
            <% if answer.question.answer_multi_choice? %>
              <%= ": #{t "activerecord.attributes.answer_option.options.#{answer.answer_option.option}"}" %>
            <% elsif answer.question.answer_written? %>
              <%= ": #{answer.answer}" %>
            <% end %>
          <% end %>
          <br>
          <% if answer.comments.present? %>
            <%= Answer.human_attribute_name :comments %>:
            <%= answer.comments %>
          <% end %>
        </li>
      <% end %>
    </ol>

    <% if poll.comments.present? %>
      <p>
        <strong><%= Poll.human_attribute_name :comments %>: </strong>
        <%= poll.comments %>
      </p>
    <% end %>
  <% end %>
  <hr>
  <p style="margin: 1em 0;">
    <%= "#{t('poll.total_answered')}: #{@answered}" %><br>
    <%= "#{t('poll.total_unanswered')}: #{@unanswered}" %><br>
    <br>
    <strong><%= "#{t('poll.score')}: #{@calification}%" %></strong>
  </p>
<% else %>
  <p style="margin: 1em 0;">
    <em><%= t('poll.without_data') %></em>
  </p>
<% end %>

<hr />

<div class="form-footer">
  <%= link_to t('label.back'), :action => :index %> |
  <%= link_to t('label.download'), '#', onclick:
    "Helper.showItem('#customize_report_form'); return false;" %>
</div>
<div id="customize_report_form" style="display: none;">
  <div>
  <%= render :partial => 'shared/customize_report_form', :locals => {
    :options => {
      :form_name => 'report',
      :url => request.query_parameters.merge(
        {:action => :create_summary_by_answers, :_ts => Time.now.to_i}
      ),
      :fields => [
        {
          :name => :report_title,
          :label => t('customize_report_form.title'),
          :value => t('poll.report_title')
        },
        {
          :name => :report_subtitle,
          :label => t('customize_report_form.subtitle'),
          :value => t('poll.summary_by_answers_subtitle')
        }
      ]
    }
  } %>
  </div>
</div>
