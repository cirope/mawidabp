<% url = options[:url] || url_for(:action => :index) %>
<% extra_parameters = options[:extra_parameters] || [] %>
<% columns_for_sort = options[:columns_for_sort] || [] %>
<% query_string = params[:search] ? params[:search][:query] : nil %>
<% order_field = params[:search] ? params[:search][:order] : nil %>
<div id="search" <%= @query.blank? && @order_by.blank? ? 'style="display: none;"' : 'class="visible"' %>>
  <div>
    <%= form_for :search, nil, :url => url, :html => {:method => :get} do |f| %>
      <table>
        <tbody>
          <tr>
            <td style="width: <%= columns_for_sort.empty? ? '99%' : '70%' %>;">
              <%= f.text_field :query, :value => query_string,
                :maxlength => 100, :size => 10 %>
              <div id="search_column_names" style="display: none;">
                <% columns.each do |column| %>
                  <%= f.hidden_field :columns, :value => column,
                    :name => 'search[columns][]',
                    :id => "search_column_#{column}" %>
                <% end %>
              </div>
            </td>
            <% unless columns_for_sort.empty? %>
              <td style="width: 29%">
                <%= f.select :order,
                  sort_options_array(columns_for_sort.map { |name, p| [p[:name], name.to_s] }),
                  :prompt => t('message.sort_by'), :selected => order_field %>
              </td>
            <% end %>
            <td>
              <span class="button"><%= f.submit t(:'label.search') %></span>
            </td>
            <td>
              <%= link_to t(:'label.cancel'), url,
                {:style => 'margin-left: 1em;'} %>
            </td>
          </tr>
        </tbody>
      </table>
      <% unless extra_parameters.empty? %>
        <div style="display: none;">
          <% extra_parameters.each do |parameter_name, parameter_value| %>
            <%= hidden_field_tag parameter_name, parameter_value %>
          <% end %>
        </div>
      <% end %>
    <% end %>
  </div>
</div>
<% unless @query.blank? %>
  <% content_for :js_extra_bottom do %>
    $('search_query').focus();
    Search.observe();
  <% end %>
<% end %>