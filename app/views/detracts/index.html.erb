<%= render :partial => 'shared/search', :locals => {
  :options => {},
  :columns => @query.blank? ? User::COLUMNS_FOR_SEARCH.keys : @columns
} %>

<table>
  <thead id="column_headers">
    <tr>
      <th></th>
      <%= make_filterable_column User.human_attribute_name(:user), 'user' %>
      <%= make_filterable_column User.human_attribute_name(:name), 'name', 'last_name' %>
      <%= make_filterable_column User.human_attribute_name(:function), 'function' %>
      <%= make_not_available_column t(:'detract.last_detract') %>
      <th colspan="3" style="text-align: right;"><%= link_to_search %></th>
    </tr>
  </thead>

  <tbody>
    <tr class="<%= cycle(:even, :odd) %>"><td></td><td colspan="6"></td><td></td></tr>
    <% @users.each do |user| -%>
      <% detract = user.detracts.for_organization(@auth_organization).last -%>
      <tr class="<%= cycle(:even, :odd) %>">
        <td></td>
        <td><%= h user.user %></td>
        <td><%= h user.full_name %></td>
        <td><%= super_truncate user.function, 25 %></td>
        <td><%= h detract.try(:value) || '-' %></td>
        <td><%= link_to image_tag('new_document.gif', :size => '22x20',
          :alt => t(:'label.new'), :title => t(:'label.new')),
          new_detract_path(:detract => {:user_id => user.id}),
          :class => :image_link %></td>
        <td><%= link_to_show detract if detract %></td>
        <td></td>
      </tr>
      <tr class="<%= cycle(:even, :odd) %>"><td></td><td colspan="6"></td><td></td></tr>
    <% end -%>
  </tbody>
</table>

<div id="links">
  <%= pagination_links(@users) %>
  <div style="clear: both;"></div>
</div>