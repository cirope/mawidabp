<% if params[:control_objective].blank? %>
  <%= render :partial => 'shared/search', :locals => {
    :options => {:columns_for_sort => PotentialNonconformity.columns_for_sort},
    :columns => @query.blank? ? PotentialNonconformity::COLUMNS_FOR_SEARCH.keys : @columns
  } %>
<% end %>
<table class="table table-condensed table-striped">
  <thead>
    <tr>
      <th></th>
      <%= make_filterable_column Review.model_name.human, nil, 'review' %>
      <%= make_filterable_column PlanItem.human_attribute_name(:project), { :class => 'hidden-xs' }, 'project' %>
      <%= make_filterable_column PotentialNonconformity.human_attribute_name(:review_code), nil, 'review_code' %>
      <%= make_filterable_column PotentialNonconformity.human_attribute_name(:title), { :class => 'hidden-xs' }, 'title' %>
      <%= make_not_available_column PotentialNonconformity.human_attribute_name(:state), :class => 'hidden-xs' %>
      <%= make_not_available_column t('finding.has_work_papers'), :class => 'hidden-xs' %>
      <th colspan="2" style="text-align: right;"><%= link_to_search if params[:control_objective].blank? %></th>
    </tr>
  </thead>

  <tbody>
    <% @potential_nonconformities.each do |potential_nonconformity| %>
      <tr <%== 'class="text-muted"' if potential_nonconformity.is_in_a_final_review? %>>
        <td><%= finding_updated_at_text potential_nonconformity %></td>
        <td class="nowrap"><%= show_review_with_close_date_as_abbr potential_nonconformity.review %></td>
        <td class="hidden-xs"><%= super_truncate potential_nonconformity.review.try(:plan_item).try(:project), 20 %></td>
        <td class="nowrap"><%= show_finding_review_code_with_decription_as_abbr(potential_nonconformity) %></td>
        <td class="hidden-xs"><%= super_truncate potential_nonconformity.title, 20 %></td>
        <td class="hidden-xs"><%= potential_nonconformity.state_text %></td>
        <td class="hidden-xs"><%= t potential_nonconformity.work_papers.blank? ? 'label.no' : 'label.yes' %></td>
        <td><%= link_to_show potential_nonconformity %></td>
        <td><%= link_to_edit edit_potential_nonconformity_path(potential_nonconformity) %></td>
      </tr>
    <% end %>
  </tbody>
</table>

<hr />

<div>
  <%= paginate @potential_nonconformities %>
  <% if params[:control_objective].to_i > 0 %>
    <%= link_to t('label.new'), new_potential_nonconformity_path(
      :control_objective_item => params[:control_objective]) %>
  <% end %>
</div>
