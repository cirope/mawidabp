<% if params[:control_objective].blank? -%>
  <%= render :partial => 'shared/search', :locals => {
    :options => {},
    :columns => @query.blank? ? Oportunity::COLUMNS_FOR_SEARCH.keys : @columns
  } %>
<% end -%>
<table>
  <thead id="column_headers">
    <tr>
      <th></th>
      <%= make_filterable_column Review.human_name, 'review' %>
      <%= make_filterable_column PlanItem.human_attribute_name(:project), 'project' %>
      <%= make_filterable_column Oportunity.human_attribute_name(:review_code), 'review_code' %>
      <%= make_filterable_column Oportunity.human_attribute_name(:description), 'description' %>
      <%= make_not_available_column Oportunity.human_attribute_name(:state) %>
      <%= make_not_available_column Oportunity.human_attribute_name(:solution_date) %>
      <%= make_not_available_column t(:'finding.has_work_papers') %>
      <th colspan="4" style="text-align: right;"><%= link_to_search if params[:control_objective].blank? %></th>
    </tr>
  </thead>

  <tbody>
    <tr class="<%= cycle(:even, :odd) %>"><td></td><td colspan="10"></td><td></td></tr>
    <% @oportunities.each do |oportunity| -%>
      <tr class="<%= cycle(:even, :odd) %> <%= oportunity.is_in_a_final_review? ? :readonly_item : :writable_item %>">
        <td></td>
        <td class="nowrap"><%= show_review_with_close_date_as_acronym oportunity.review %></td>
        <td><%= super_truncate oportunity.review.try(:plan_item).try(:project), 20 %></td>
        <td class="nowrap"><%= show_finding_review_code_with_control_objective_as_acronym(oportunity) %></td>
        <td><%= super_truncate oportunity.description, 20 %></td>
        <td><%= h oportunity.state_text %></td>
        <td><%= l oportunity.solution_date, :format => :short if oportunity.solution_date %></td>
        <td><%= t oportunity.work_papers.blank? ? :'label.no' : :'label.yes' %></td>
        <td><%= link_to_show oportunity %></td>
        <td><%= link_to_edit edit_oportunity_path(oportunity) %></td>
        <td><%= button_to_destroy oportunity %></td>
        <td></td>
      </tr>
      <tr class="<%= cycle(:even, :odd) %>"><td></td><td colspan="10"></td><td></td></tr>
    <% end -%>
  </tbody>
</table>

<div id="links">
  <%= pagination_links @oportunities %>
  <% if params[:control_objective].to_i > 0 -%>
    <%= link_to t(:'label.new'), new_oportunity_path(
      :control_objective_item => params[:control_objective]) %>
  <% end -%>
  <div style="clear: both;"></div>
</div>