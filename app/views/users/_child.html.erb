<% id = "#{dynamic_object_id('child', f)}_#{is_dynamic ? 'NEW_RECORD' : child.id}" %>
<div class="child item" id="<%= id %>" <%= raw 'style="display: none;"' if is_dynamic %>>
  <div class="row">
    <div class="col-md-6">
      <% if child.new_record? %>
        <div class="search">
          <% field_classes = [:search, :autocomplete_field, 'form-control'] %>
          <%= f.input :nested_user, label: false, input_html: {
            id: "user_child_#{id}",
            class: field_classes.join(' '),
            title: t('label.search'),
            autocomplete: :off,
            autofocus: true,
            'data-autocomplete-params' => ("{user_id: #{@user.id}}" unless @user.new_record?),
            'data-autocomplete-url' => auto_complete_for_user_users_path
          } %>
          <%= hidden_field_tag 'user[child_ids][]', child.id,
            :id => "hidden_child_#{id}", :class => :autocomplete_id %>
        </div>
      <% else %>
        <%= f.input "user_child_#{id}", label: false, input_html: {
          value: child.full_name_with_function, readonly: true
        } %>
        <%= hidden_field_tag 'user[child_ids][]', child.id,
          :id => "hidden_child_#{id}" %>
      <% end %>
    </div>
    <div class="col-md-6">
      <%= remove_list_item_link(f) %>
    </div>
  </div>
</div>
<% if is_dynamic %>
  <script type="text/javascript">
    Helper.showItem('#<%= id %>');
  </script>
<% end %>
