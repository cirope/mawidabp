<%= simple_form_for @user, :url => url do |f| %>
  <%= f.error_notification %>

  <div class="form-inputs">
    <div class="row">
      <div class="col-md-6">
        <%= f.input :user, input_html: { maxlength: 30, autofocus: true } %>
        <%= f.input :name, input_html: { maxlength: 100 } %>
        <%= f.input :last_name, input_html: { maxlength: 100 } %>
        <%= f.input :email, input_html: { maxlength: 100 } %>
        <%= f.input :function, input_html: { maxlength: 255 } %>
      </div>
      <div class="col-md-6">
        <%= f.input :notes %>
        <%= user_resource_field(f) %>
        <%= user_language_field(f) %>
        <%= f.input :logged_in, label: false, inline_label: true %>
        <%= f.input :enable, label: false, inline_label: true %>
        <%= f.input :hidden, label: false, inline_label: true %>
        <%= f.input :send_notification_email, label: false, inline_label: true %>
        <%= f.input :lock_version, as: :hidden %>
      </div>
    </div>

    <% if @auth_user %>
      <h3><%= User.human_attribute_name(:manager_id) %></h3>

      <div id="parent">
        <%= render partial: 'parent', locals: { f: f } %>
      </div>

      <h3><%= t('user.children') %></h3>

      <div id="children">
        <%= render partial: 'child', collection: @user.children, locals: { f: f } %>
      </div>

      <%= link_to_add_fields(t('user.add_child'), f, :related_user_relations, 'users/child') %>
    <% end %>

    <h3><%= RelatedUserRelation.human_attribute_name 'related_user_id' %></h3>

    <div id="related_user_relations">
      <%= f.simple_fields_for :related_user_relations do |r_f| %>
        <%= render partial: 'related_user_relation', locals: { f: r_f } %>
      <% end %>
    </div>

    <%= link_to_add_fields(t('user.add_related_user_relations'), f, :related_user_relations) %>

    <h3><%= OrganizationRole.human_attribute_name :organization_id %></h3>
    <h3><%= OrganizationRole.human_attribute_name :role_id %></h3>

    <div id="organization_roles">
      <% organization_roles =
        @user.organization_roles.select { |o_r| o_r.new_record? || o_r.marked_for_destruction? } |
        @user.organization_roles.for_group(current_organization.group_id)
      %>
      <%= f.simple_fields_for :organization_roles, organization_roles do |or_f| %>
        <%= render partial: 'organizations/organization_role', locals: { f: or_f } %>
      <% end %>
    </div>

    <%= link_to_add_fields(t('user.add_organization_role'), f,
      :organization_roles, 'organizations/organization_role') %>
  </div>

  <div class="form-actions form-footer">
    <%= f.submit class: 'btn btn-primary' %>
  </div>
<% end %>
