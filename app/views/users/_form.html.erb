<%= simple_form_for @user do |f| %>
  <%= render 'shared/error_explanation', f: f %>

  <div class="form-inputs">
    <div class="row">
      <div class="col-md-6">
        <%= f.input :user, input_html: { maxlength: 30, autofocus: true } %>
        <%= f.input :name, input_html: { maxlength: 100 } %>
        <%= f.input :last_name, input_html: { maxlength: 100 } %>
        <%= f.input :email, input_html: { maxlength: 100 } %>
        <%= f.input :function, input_html: { maxlength: 255 } %>
      </div>
      <div class="col-md-6">
        <%= f.input :notes, input_html: { rows: 4 } %>
        <%= user_language_field f %>
        <%= f.input :enable, label: false, inline_label: true %>
        <%= f.input :hidden, label: false, inline_label: true %>
        <%= f.input :send_notification_email, as: :boolean,
          checked_value: '1', unchecked_value: '', label: false, inline_label: true %>
        <%= f.input :lock_version, as: :hidden %>
      </div>
    </div>
  </div>

  <h5><strong><%= User.human_attribute_name 'manager_id' %></strong></h5>

  <div class="row">
    <div class="col-md-6">
      <%= f.input :manager, as: :string, label: false,
        input_html: {
          value: @user.parent.try(:full_name_with_function),
          title: t('label.search'),
          data: {
            autocomplete_url: users_completions_path,
            autocomplete_id_target: '#user_manager_id'
          }
        } %>
      <%= f.input :manager_id, as: :hidden %>
    </div>

    <div class="col-md-6">
      <div class="toggle-visibility">
        <%= link_to t('.unlink_manager'), '#', data: { clear_user_manager: true } %>
      </div>
    </div>
  </div>

  <h5><strong><%= t '.children' %></strong></h5>

  <div id="children">
    <%= render partial: 'child', collection: @user.children, locals: { f: f } %>
    <%= link_to_add_fields t('.add_child'), f, :children, 'new_child' %>
  </div>

  <br />
  <h5>
    <strong><%= RelatedUserRelation.human_attribute_name 'related_user_id' %></strong>
  </h5>

  <div id="related_user_relations">
    <%= f.simple_fields_for :related_user_relations do |rur_f| %>
      <%= render 'related_user_relation', f: rur_f %>
    <% end %>

    <%= link_to_add_fields t('.add_related_user_relations'), f, :related_user_relations %>
  </div>

  <br />
  <div class="row">
    <div class="col-md-6">
      <h5>
        <strong><%= OrganizationRole.human_attribute_name 'organization_id' %></strong>
      </h5>
    </div>
    <div class="col-md-6">
      <h5>
        <strong><%= OrganizationRole.human_attribute_name 'role_id' %></strong>
      </h5>
    </div>
  </div>

  <div id="organization_roles">
    <%= f.simple_fields_for :organization_roles, user_organization_roles do |or_f| %>
      <%= render 'organization_role', f: or_f %>
    <% end %>

    <%= link_to_add_fields t('.add_organization_role'), f, :organization_roles %>
  </div>

  <hr />

  <div class="form-actions">
    <div class="pull-right"><%= yield :form_actions %></div>
    <%= f.submit class: 'btn btn-primary' %>
  </div>
<% end %>
