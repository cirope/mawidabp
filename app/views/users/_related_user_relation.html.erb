<% related_user_relation = f.object %>
<% id = "#{dynamic_object_id('related_user_relation', f)}_#{is_dynamic ? 'NEW_RECORD' : related_user_relation.id}" %>
<div class="related_user_relation item" id="<%= id %>" <%= raw 'style="display: none;"' if is_dynamic %>>
  <div>
    <div class="item_field" style="width: 50%;">
      <% if related_user_relation.new_record? %>
        <div class="search">
          <% field_classes = [:search, :autocomplete_field] %>
          <%= text_field_tag :nested_user, '',
            :id => "user_related_user_relation_#{id}",
            :class => field_classes.join(' '),
            :title => t('label.search'),
            :autocomplete => :off,
            :autofocus => true,
            'data-autocomplete-params' => ("{user_id: #{@user.id}}" unless @user.new_record?),
            'data-autocomplete-url' => auto_complete_for_user_users_path %>
          <%= f.hidden_field :related_user_id,
            :id => "hidden_related_user_relation_#{id}", :class => :autocomplete_id %>
        </div>
      <% else %>
        <%= text_field_tag "user_related_user_relation_#{id}",
          related_user_relation.related_user.try(:full_name_with_function),
          :readonly => true %>
        <%= f.hidden_field :related_user_id,
          :id => "hidden_related_user_relation_#{id}" %>
      <% end %>
    </div>
    <div class="item_field item_controls" style="width: 10%;">
      <%= remove_item_link(f) %>
    </div>
  </div>
</div>
<% if is_dynamic %>
  <script type="text/javascript">
    Helper.showItem('#<%= id %>');
    AutoComplete.observeAll();
  </script>
<% end %>